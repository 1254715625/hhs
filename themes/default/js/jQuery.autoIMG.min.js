(function ($) { 
var isMaxWidth = 'maxWidth' in document.documentElement.style, 
isIE7 = !-[1,] && !('prototype' in Image) && isMaxWidth; 
$.fn.autoIMG = function () { 
var maxWidth = this.width(); 
return this.find('img').each(function (i, img) { 
if (isMaxWidth) return img.style.maxWidth = maxWidth + 'px'; 
var src = img.src; 
img.style.display = 'none'; 
img.removeAttribute('src'); 
imgReady(src, function (width, height) { 
if (width > maxWidth) { 
height = maxWidth / width * height, 
width = maxWidth; 
img.style.width = width + 'px'; 
img.style.height = height + 'px'; 
}; 
img.style.display = ''; 
img.setAttribute('src', src); 
}); 
}); 
}; 
isIE7 && (function (c,d,s) {s=d.createElement('style');d.getElementsByTagName('head')[0].appendChild(s);s.styleSheet&&(s.styleSheet.cssText+=c)||s.appendChild(d.createTextNode(c))})('img {-ms-interpolation-mode:bicubic}',document); 
var imgReady = (function () { 
var list = [], intervalId = null, 
tick = function () { 
var i = 0; 
for (; i < list.length; i++) { 
list[i].end ? list.splice(i--, 1) : list[i](); 
}; 
!list.length && stop(); 
}, 
stop = function () { 
clearInterval(intervalId); 
intervalId = null; 
}; 
return function (url, ready, load, error) { 
var check, width, height, newWidth, newHeight, 
img = new Image(); 
img.src = url; 
if (img.complete) { 
ready(img.width, img.height); 
load && load(img.width, img.height); 
return; 
};
width = img.width; 
height = img.height; 
check = function () { 
newWidth = img.width; 
newHeight = img.height; 
if (newWidth !== width || newHeight !== height || 
newWidth * newHeight > 1024 
) { 
ready(newWidth, newHeight); 
check.end = true; 
}; 
}; 
check(); 
img.onerror = function () { 
error && error(); 
check.end = true; 
img = img.onload = img.onerror = null; 
};
img.onload = function () { 
load && load(img.width, img.height); 
!check.end && check(); 
img = img.onload = img.onerror = null; 
};
if (!check.end) { 
list.push(check); 
if (intervalId === null) intervalId = setInterval(tick, 40); 
}; 
}; 
})();
})(jQuery);